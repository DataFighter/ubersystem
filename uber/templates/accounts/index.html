{% extends "base-admin.html" %}

{% block title %}
    Accounts
{% endblock title %}

{% block content %}

<h3>
    New Account
</h3>

<form id="new_admin" method="post" action="update" onsubmit="return check_passwords()" role="form" class="form-inline">
<input type="hidden" name="id" value="None" />
{% csrf_token %}
<ul>
    <li>
        <label for="attendee_id">Attendee</label>
        <select id="attendee_id" name="attendee_id">
            {% options all_attendees %}
        </select>
    </li>
    <li>
        <label for="password">Password</label>
        <input type="password" id="password" name="password"
           {% if not c.AT_THE_CON %}disabled{% endif %}>
           {% if not c.AT_THE_CON %}
               <span class="input-group-addon glyphicon glyphicon-ban-circle">
               </span>
           {% endif %}
    </li>
    <li>
        <label for="check-password">Re-enter Password</label>
        <input type="password" class="form-control" id="check-password" name="check-password" {% if not c.AT_THE_CON %}disabled{% endif %}>
    </li>
    <li>
        {% checkgroup AdminAccount.access %}
    </li>
        <li>
            <button type="submit">
                Create Account
            </button>
        </li>
    </ul>
</form>

<h3>
    Existing Accounts
</h3>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th data-hide="phone">Access</th>
            <th></th>
        </tr>
    </thead>

    <tbody>
    {% for account in accounts %}
        <tr id="{{ account.email|idize }}">
            <td data-order="{{ account.attendee.last_first }}" data-search="{{ account.attendee.last_first }}">
                <a href="../registration/form?id={{ account.attendee.id }}">
                    {{ account.attendee.last_first }}
                </a>
            </td>
            <td>
                <a href="mailto:{{ account.attendee.email }}">
                    {{ account.attendee.email }}
                </a>
            </td>
            <td>
                <form class="form update-form" method="post" action="update">
                    <input type="hidden" name="id" value="{{ account.id }}" />
                    {% csrf_token %}
                    {% checkgroup account.access %}
                </form>
            </td>
            <td>
                <button type="submit" class="update-button">
                    Save
                </button>
                <form method="post" action="delete">
                    <input type="hidden" name="id" value="{{ account.id }}" />
                    <button type="submit" type="button" class="delete-button">
                        Delete
                    </button>
                </form>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>


<script>
    function check_passwords() {
        if (document.getElementById("password").value != document.getElementById("check-password").value) {
            alert("Passwords must match");
            return false;
        }
        return true;
    }

$(function() {
    $(document.body).on('click', '.delete-button', function (event) {
        event.preventDefault();
        $.confirm({
            text: 'Are you sure you want to delete that account?',
            confirm: function () {
                $(event.target).parents('form').submit();
            },
            cancel: function () { }
        });
    });
    $(document.body).on('click', '.update-button', function (event) {
        $(event.target).parents('tr').find('.update-form').submit();
    });
});
</script>

{% endblock content%}
